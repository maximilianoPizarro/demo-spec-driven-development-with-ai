schemaVersion: 2.3.0
metadata:
  name: demo-spec-driven-development-with-ai
attributes:
  controller.devfile.io/storage-type: ephemeral  
components:
  - name: tools
    container:
      image: quay.io/che-incubator/cli-ai-tools:latest
      memoryLimit: 10G
      memoryRequest: 2G
      cpuRequest: 1000m
      cpuLimit: 5000m
      volumeMounts:
        - name: completions
          path: /mnt/data/completions
        - name: confd
          path: /mnt/data/conf.d
        - name: functions
          path: /mnt/data/functions
        - name: config-volume
          path: /home/user/.config           
      endpoints:
        - exposure: public
          name: ra-aid
          protocol: https
          targetPort: 3000          
      env:
        - name: RA_AID_PROVIDER
          value: openai
        - name: RA_AID_MODEL
          value: llama3:llama-3-2-3b
        - name: RA_AID_BACKEND
          value: openai      
        - name: OLLAMA_API_BASE
          value: https://llama-3-2-3b-maas-apicast-production.apps.prod.rhoai.rh-aiservices-bu.com:443
        - name: OLLAMA_BASE_URL
          value: https://llama-3-2-3b-maas-apicast-production.apps.prod.rhoai.rh-aiservices-bu.com:443
        - name: OPENAI_API_KEY
          value: MzkxN2MwNTlmNmFlMDY2ZWIyYjQ1OTEyMjM0YzYxZjI=                
  - name: completions
    volume:
      size: 512Mi
  - name: confd
    volume:
      size: 512Mi
  - name: functions
    volume:
      size: 512Mi
  - name: config-volume 
    volume:
      size: 512Mi      
commands:
  - id: oc-add-secret
    exec:
      label: 'OpenShift apply secret (OpenShift cluster)'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'oc apply -f secret.yaml'
  - id: ra-aid-gen-spec
    exec:
      label: 'RA Aid gen with spec'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'ra-aid --use-aider --cowboy-mode --show-cost --track-cost --msg-file spec.md --provider openai --model llama3:llama-3-2-3b'
  - id: ra-aid-server
    exec:
      label: 'RA Aid run server'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'ra-aid --server --server-host 0.0.0.0 --server-port 3000'          
events:
  postStart:
    - oc-add-secret  
